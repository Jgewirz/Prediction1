<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalshi Trading Bot Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        
    </style>
</head>
<body>
    <!-- Main Dashboard -->
    <div id="dashboard-container">
        <!-- Status Banner -->
        <div class="status-banner dry-run" id="status-banner">
            <div class="status-left">
                <span class="mode-badge" id="mode-badge">DRY RUN MODE</span>
                <span class="mode-text">No actual bets will be placed</span>
            </div>
            <div class="status-right">
                <span id="connection-status" class="connection-indicator connecting">Connecting...</span>
                <span class="divider">|</span>
                <span class="status-item">Last Update: <span id="last-update">--</span></span>
                <span class="divider">|</span>
                <span class="status-item">Status: <span id="bot-status" class="status-indicator">--</span></span>
                <span class="divider">|</span>
                
            </div>
        </div>

        <!-- Kalshi Account Data (Real API) -->
        <div class="account-panel" id="account-panel">
            <div class="account-header">
                <h3>Kalshi Account</h3>
                <span class="api-status" id="api-status">Connecting...</span>
            </div>
            <div class="account-cards">
                <div class="account-card">
                    <div class="value" id="account-balance">$0.00</div>
                    <div class="label">Available Balance</div>
                </div>
                <div class="account-card">
                    <div class="value" id="account-portfolio">$0.00</div>
                    <div class="label">Portfolio Value</div>
                </div>
                <div class="account-card highlight">
                    <div class="value" id="account-equity">$0.00</div>
                    <div class="label">Total Equity</div>
                </div>
                <div class="account-card">
                    <div class="value" id="account-positions">0</div>
                    <div class="label">Open Positions</div>
                </div>
                <div class="account-card">
                    <div class="value" id="account-exposure">$0.00</div>
                    <div class="label">Market Exposure</div>
                </div>
                <div class="account-card">
                    <div class="value" id="account-realized-pnl">$0.00</div>
                    <div class="label">Realized P&L</div>
                </div>
            </div>
        </div>

        <!-- KPI Grid (Bot Decisions) -->
        <div class="kpi-grid" id="kpi-grid">
            <div class="kpi-card">
                <div class="value" id="kpi-pnl">$0.00</div>
                <div class="label">Bot P&L (7d)</div>
            </div>
            <div class="kpi-card">
                <div class="value" id="kpi-winrate">0%</div>
                <div class="label">Win Rate</div>
            </div>
            <div class="kpi-card">
                <div class="value" id="kpi-edge">0%</div>
                <div class="label">Avg Edge</div>
            </div>
            <div class="kpi-card">
                <div class="value" id="kpi-rscore">0.00</div>
                <div class="label">Avg R-Score</div>
            </div>
            <div class="kpi-card">
                <div class="value" id="kpi-exposure">$0.00</div>
                <div class="label">Open Exposure</div>
            </div>
            <div class="kpi-card">
                <div class="value" id="kpi-trades">0</div>
                <div class="label">Trades (7d)</div>
            </div>
            <div class="kpi-card">
                <div class="value" id="kpi-skipped">0</div>
                <div class="label">Skipped</div>
            </div>
        </div>

        <!-- CLI Terminal Panel -->
        <div class="cli-panel" id="cli-panel">
            <div class="cli-header">
                <h3>Live CLI Output</h3>
                <div class="cli-controls">
                    <span class="log-count" id="log-count">0 entries</span>
                    <button class="cli-btn" onclick="clearLogs()">Clear</button>
                    <button class="cli-btn" onclick="toggleAutoScroll()" id="autoscroll-btn">Auto-scroll: ON</button>
                </div>
            </div>
            <div class="cli-terminal" id="cli-terminal">
                <div class="cli-log info">[System] Connecting to trading bot...</div>
            </div>
        </div>

        <!-- Workflow Progress Panel -->
        <div class="workflow-panel" id="workflow-panel">
            <div class="workflow-header">
                <h3>Workflow Progress</h3>
                <span class="workflow-status" id="workflow-status">Idle</span>
            </div>
            <div class="workflow-steps" id="workflow-steps">
                <div class="workflow-step pending" data-step="1">
                    <span class="step-icon">○</span>
                    <span class="step-name">Fetching events</span>
                    <span class="step-details"></span>
                </div>
                <div class="workflow-step pending" data-step="2">
                    <span class="step-icon">○</span>
                    <span class="step-name">Processing markets</span>
                    <span class="step-details"></span>
                </div>
                <div class="workflow-step pending" data-step="3">
                    <span class="step-icon">○</span>
                    <span class="step-name">Filtering positions</span>
                    <span class="step-details"></span>
                </div>
                <div class="workflow-step pending" data-step="4">
                    <span class="step-icon">○</span>
                    <span class="step-name">Fetching signals</span>
                    <span class="step-details"></span>
                </div>
                <div class="workflow-step pending" data-step="5">
                    <span class="step-icon">○</span>
                    <span class="step-name">Researching events</span>
                    <span class="step-details"></span>
                </div>
                <div class="workflow-step pending" data-step="6">
                    <span class="step-icon">○</span>
                    <span class="step-name">Extracting probabilities</span>
                    <span class="step-details"></span>
                </div>
                <div class="workflow-step pending" data-step="7">
                    <span class="step-icon">○</span>
                    <span class="step-name">Fetching odds</span>
                    <span class="step-details"></span>
                </div>
                <div class="workflow-step pending" data-step="8">
                    <span class="step-icon">○</span>
                    <span class="step-name">Generating decisions</span>
                    <span class="step-details"></span>
                </div>
                <div class="workflow-step pending" data-step="9">
                    <span class="step-icon">○</span>
                    <span class="step-name">Saving decisions</span>
                    <span class="step-details"></span>
                </div>
                <div class="workflow-step pending" data-step="10">
                    <span class="step-icon">○</span>
                    <span class="step-name">Placing bets</span>
                    <span class="step-details"></span>
                </div>
            </div>
            <div class="workflow-timestamp" id="workflow-timestamp">Last run: --</div>
        </div>

        <!-- Period Selector -->
        <div class="period-selector">
            <button class="period-btn" data-period="today">Today</button>
            <button class="period-btn active" data-period="7d">7 Days</button>
            <button class="period-btn" data-period="30d">30 Days</button>
            <button class="period-btn" data-period="all">All Time</button>
        </div>

        <!-- Filters Bar -->
        <div class="filters-bar">
            <div class="filter-group">
                <label>Action</label>
                <select id="filter-action">
                    <option value="all">All Actions</option>
                    <option value="buy_yes">BUY YES</option>
                    <option value="buy_no">BUY NO</option>
                    <option value="skip">SKIP</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Min Confidence</label>
                <input type="number" id="filter-confidence" placeholder="0.0" min="0" max="1" step="0.1">
            </div>
            <div class="filter-group">
                <label>Status</label>
                <select id="filter-status">
                    <option value="all">All</option>
                    <option value="pending">Pending</option>
                    <option value="settled">Settled</option>
                    <option value="skipped">Skipped</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Signal</label>
                <select id="filter-signal">
                    <option value="all">All Signals</option>
                    <option value="aligned">Aligned</option>
                    <option value="conflicting">Conflicting</option>
                    <option value="neutral">Neutral</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Search</label>
                <input type="text" id="filter-search" placeholder="Event or market...">
            </div>
            <button class="filter-btn" onclick="applyFilters()">Apply</button>
            <button class="filter-btn secondary" onclick="clearFilters()">Clear</button>
        </div>

        <!-- Table Title -->
        <div class="table-header">
            <h2>Bets to be Placed</h2>
            <span class="decision-count" id="decision-count">0 decisions</span>
        </div>

        <!-- Decisions Table -->
        <div class="table-container">
            <table class="decisions-table" id="decisions-table">
                <thead>
                    <tr>
                        <th class="sortable" data-sort="timestamp">Time</th>
                        <th>Event</th>
                        <th>Market</th>
                        <th class="sortable" data-sort="action">Action</th>
                        <th class="sortable numeric" data-sort="bet_amount">Amount</th>
                        <th class="numeric">Research %</th>
                        <th class="numeric">Market %</th>
                        <th class="sortable numeric" data-sort="confidence">Confidence</th>
                        <th class="numeric">R-Score</th>
                        <th>Signal</th>
                        <th>Reasoning</th>
                    </tr>
                </thead>
                <tbody id="decisions-body">
                    <tr class="loading-row">
                        <td colspan="11">Loading decisions...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination">
            <button class="page-btn" id="prev-btn" onclick="prevPage()" disabled>Previous</button>
            <span class="page-info" id="page-info">Page 1 of 1</span>
            <button class="page-btn" id="next-btn" onclick="nextPage()" disabled>Next</button>
        </div>

        <!-- Reasoning Modal -->
        <div class="modal" id="reasoning-modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Decision Details</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

        <script>
        // Public dashboard - no auth required
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof initDashboard === 'function') {
                initDashboard();
            }
        });
    </script>
    <script src="/static/app.js"></script>
</body>
</html>
